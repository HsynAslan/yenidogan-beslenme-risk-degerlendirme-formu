unit yenidoganRisk;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxSkinsCore, dxSkinBasic, dxSkinBlack, dxSkinBlue,
  dxSkinBlueprint, dxSkinCaramel, dxSkinCoffee, dxSkinDarkroom, dxSkinDarkSide,
  dxSkinDevExpressDarkStyle, dxSkinDevExpressStyle, dxSkinFoggy,
  dxSkinGlassOceans, dxSkinHighContrast, dxSkiniMaginary, dxSkinLilian,
  dxSkinLiquidSky, dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMetropolis,
  dxSkinMetropolisDark, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinOffice2010Black, dxSkinOffice2010Blue,
  dxSkinOffice2010Silver, dxSkinOffice2013DarkGray, dxSkinOffice2013LightGray,
  dxSkinOffice2013White, dxSkinOffice2016Colorful, dxSkinOffice2016Dark,
  dxSkinOffice2019Black, dxSkinOffice2019Colorful, dxSkinOffice2019DarkGray,
  dxSkinOffice2019White, dxSkinPumpkin, dxSkinSeven, dxSkinSevenClassic,
  dxSkinSharp, dxSkinSharpPlus, dxSkinSilver, dxSkinSpringtime, dxSkinStardust,
  dxSkinSummer2008, dxSkinTheAsphaltWorld, dxSkinTheBezier, dxSkinValentine,
  dxSkinVisualStudio2013Blue, dxSkinVisualStudio2013Dark,
  dxSkinVisualStudio2013Light, dxSkinVS2010, dxSkinWhiteprint, dxSkinWXI,
  dxSkinXmas2008Blue, cxScrollBox, cxContainer, cxEdit, cxDBLabel, cxLabel,
  Vcl.ExtCtrls, Vcl.StdCtrls, cxGroupBox, Data.DB, cxTextEdit, cxDBEdit,
  cxMaskEdit, cxButtonEdit, MemDS, DBAccess, Ora, OraCall, cxCheckBox;

type
  TForm2 = class(TForm)
    scrMain: TcxScrollBox;
    grpAna1: TcxGroupBox;
    grpAna2: TcxGroupBox;
    grdpnl1: TGridPanel;
    grpAna3: TcxGroupBox;
    grdpnl2: TGridPanel;
    cxlbl1: TcxLabel;
    cxdblbl1: TcxDBLabel;
    cxlbl2: TcxLabel;
    cxdblbl2: TcxDBLabel;
    cxlbl3: TcxLabel;
    cxdblbl3: TcxDBLabel;
    cxlbl4: TcxLabel;
    cxdblbl4: TcxDBLabel;
    grpOlcum: TcxGroupBox;
    cxlbl5: TcxLabel;
    grdpnl3: TGridPanel;
    cxlbl6: TcxLabel;
    cxlbl7: TcxLabel;
    lblGun2Tarih: TcxLabel;
    lblGun3Tarih: TcxLabel;
    lblGun4Tarih: TcxLabel;
    lblGun5Tarih: TcxLabel;
    cxlbl8: TcxLabel;
    edtKiloGun1: TcxDBTextEdit;
    edtKiloGun2: TcxDBTextEdit;
    edtKiloGun3: TcxDBTextEdit;
    edtKiloGun4: TcxDBTextEdit;
    edtKiloGun5: TcxDBTextEdit;
    cxlbl9: TcxLabel;
    edtBoyGun1: TcxDBTextEdit;
    edtBoyGun2: TcxDBTextEdit;
    edtBoyGun3: TcxDBTextEdit;
    edtBoyGun4: TcxDBTextEdit;
    edtBoyGun5: TcxDBTextEdit;
    cxLabel1: TcxLabel;
    edtBasGun1: TcxDBTextEdit;
    edtBasGun2: TcxDBTextEdit;
    edtBasGun3: TcxDBTextEdit;
    edtBasGun4: TcxDBTextEdit;
    edtBasGun5: TcxDBTextEdit;
    grdpnl4: TGridPanel;
    PaintBoxYuksekRisk: TPaintBox;
    grdpnl5: TGridPanel;
    cxlbl10: TcxLabel;
    cxlbl11: TcxLabel;
    cxlbl13: TcxLabel;
    grdpnl6: TGridPanel;
    cxlbl12: TcxLabel;
    cxlbl14: TcxLabel;
    cxlbl15: TcxLabel;
    cxlbl16: TcxLabel;
    cxlbl17: TcxLabel;
    grdpnl7: TGridPanel;
    cxlbl18: TcxLabel;
    cxlbl19: TcxLabel;
    cxlbl20: TcxLabel;
    cxlbl21: TcxLabel;
    cxlbl22: TcxLabel;
    grdpnl8: TGridPanel;
    cxlbl23: TcxLabel;
    cxlbl24: TcxLabel;
    cxlbl25: TcxLabel;
    cxlbl26: TcxLabel;
    grdpnl9: TGridPanel;
    grdpnl10: TGridPanel;
    orsn1: TOraSession;
    qrrastgeleHasta: TOraQuery;
    btnKaydet: TButton;
    fltfldHastaHASTA_ID: TFloatField;
    fltfldHastaHAFTA_NO: TFloatField;
    fltfldHastaDOSYA_NO: TFloatField;
    fltfldHastaPROTOKOL_NO: TFloatField;
    dtmfldHastaIZLEM_TARIHI: TDateTimeField;
    fltfldHastaGESTASYON_HAFTASI: TFloatField;
    fltfldHastaDOGUM_KILOSU_GR: TFloatField;
    fltfldHastaDOGUM_BOYU_CM: TFloatField;
    fltfldHastaDOGUM_BAS_CEVRESI: TFloatField;
    strngfldHastaYR_28_HAFTA: TStringField;
    strngfldHastaYR_1000_GR: TStringField;
    strngfldHastaYR_NEK_GIS: TStringField;
    strngfldHastaYR_KONJ_GIS: TStringField;
    strngfldHastaOR_28_31_HAFTA: TStringField;
    strngfldHastaOR_IUGR: TStringField;
    strngfldHastaOR_1000_1500_GR: TStringField;
    strngfldHastaOR_KONJ_BESLENME: TStringField;
    strngfldHastaDR_32_35_HAFTA: TStringField;
    strngfldHastaDR_IUGR_35: TStringField;
    strngfldHastaDR_TERM: TStringField;
    strngfldHastaRISK_SEVIYE: TStringField;
    strngfldHastaIHT_2_HAFTA_KILO: TStringField;
    strngfldHastaIHT_15_KAYIP: TStringField;
    strngfldHastaIHT_10G_KAZANIM: TStringField;
    strngfldHastaIHT_NEK_CERRAHI: TStringField;
    strngfldHastaDOKTOR_ADI: TStringField;
    dtmfldHastaKAYIT_TARIHI: TDateTimeField;
    fltfldHastaKILO_KG: TFloatField;
    fltfldHastaBOY_CM: TFloatField;
    fltfldHastaBAS_CEVRESI_CM: TFloatField;
    lbl1: TLabel;
    grdpnl11: TGridPanel;
    YR_C28G1: TcxDBCheckBox;
    YR_C1000G1: TcxDBCheckBox;
    YR_CNEKG1: TcxDBCheckBox;
    YR_CGISG1: TcxDBCheckBox;
    lbl2: TLabel;
    OR_C28G1: TcxDBCheckBox;
    OR_CIUGRG1: TcxDBCheckBox;
    OR_C1000G1: TcxDBCheckBox;
    OR_CKONJENITALG1: TcxDBCheckBox;
    grdpnl12: TGridPanel;
    lbl3: TLabel;
    DR_C32G1: TcxDBCheckBox;
    DR_CIUGRG1: TcxDBCheckBox;
    DR_C37G1: TcxDBCheckBox;
    grdpnl13: TGridPanel;
    grdpnl14: TGridPanel;
    lbl4: TLabel;
    YR_C28G2: TcxDBCheckBox;
    YR_C1000G2: TcxDBCheckBox;
    YR_CNEKG2: TcxDBCheckBox;
    YR_CGISG2: TcxDBCheckBox;
    grdpnl15: TGridPanel;
    lbl5: TLabel;
    OR_C28G2: TcxDBCheckBox;
    OR_CIUGRG2: TcxDBCheckBox;
    OR_C1000G2: TcxDBCheckBox;
    OR_CKONJENITALG2: TcxDBCheckBox;
    grdpnl16: TGridPanel;
    lbl6: TLabel;
    DR_C32G2: TcxDBCheckBox;
    DR_CIUGRG2: TcxDBCheckBox;
    DR_C37G2: TcxDBCheckBox;
    grdpnl17: TGridPanel;
    grdpnl18: TGridPanel;
    grdpnl19: TGridPanel;
    grdpnl20: TGridPanel;
    grdpnl21: TGridPanel;
    grdpnl22: TGridPanel;
    grdpnl23: TGridPanel;
    grdpnl24: TGridPanel;
    grdpnl25: TGridPanel;
    grdpnl26: TGridPanel;
    grdpnl27: TGridPanel;
    grdpnl28: TGridPanel;
    lbl7: TLabel;
    YR_C28G3: TcxDBCheckBox;
    YR_C1000G3: TcxDBCheckBox;
    YR_CNEKG3: TcxDBCheckBox;
    YR_CGISG3: TcxDBCheckBox;
    lbl8: TLabel;
    OR_C28G3: TcxDBCheckBox;
    OR_CIUGRG3: TcxDBCheckBox;
    OR_C1000G3: TcxDBCheckBox;
    OR_CKONJENITALG3: TcxDBCheckBox;
    lbl9: TLabel;
    DR_C32G3: TcxDBCheckBox;
    DR_CIUGRG3: TcxDBCheckBox;
    DR_C37G3: TcxDBCheckBox;
    lbl10: TLabel;
    YR_C28G4: TcxDBCheckBox;
    YR_C1000G4: TcxDBCheckBox;
    YR_CNEKG4: TcxDBCheckBox;
    YR_CGISG4: TcxDBCheckBox;
    lbl11: TLabel;
    OR_C28G4: TcxDBCheckBox;
    OR_CIUGRG4: TcxDBCheckBox;
    OR_C1000G4: TcxDBCheckBox;
    OR_CKONJENITALG4: TcxDBCheckBox;
    lbl12: TLabel;
    DR_C32G4: TcxDBCheckBox;
    DR_CIUGRG4: TcxDBCheckBox;
    DR_C37G4: TcxDBCheckBox;
    lbl13: TLabel;
    YR_C28G5: TcxDBCheckBox;
    YR_C1000G5: TcxDBCheckBox;
    YR_CNEKG5: TcxDBCheckBox;
    YR_CGISG5: TcxDBCheckBox;
    lbl14: TLabel;
    OR_C28G5: TcxDBCheckBox;
    OR_CIUGRG5: TcxDBCheckBox;
    OR_C1000G5: TcxDBCheckBox;
    OR_CKONJENITALG5: TcxDBCheckBox;
    lbl15: TLabel;
    DR_C32G5: TcxDBCheckBox;
    DR_CIUGRG5: TcxDBCheckBox;
    DR_C37G5: TcxDBCheckBox;
    cxlbl27: TcxLabel;
    grdpnl29: TGridPanel;
    lbl16: TLabel;
    cxlbl28: TcxLabel;
    cxlbl29: TcxLabel;
    lbl17: TLabel;
    DR_GUN1: TcxDBLabel;
    DR_GUN2: TcxDBLabel;
    DR_GUN3: TcxDBLabel;
    DR_GUN4: TcxDBLabel;
    DR_GUN5: TcxDBLabel;
    scorGun1: TcxDBLabel;
    scorGun2: TcxDBLabel;
    scorGun3: TcxDBLabel;
    scorGun4: TcxDBLabel;
    scorGun5: TcxDBLabel;
    dsRastgeleHasta: TOraDataSource;

    procedure lblGunTarihClick(Sender: TObject);
    procedure PaintBoxYuksekRiskPaint(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure btnKaydetClick(Sender: TObject);
    procedure RiskCheckBoxPropertiesChange(Sender: TObject);

    procedure RefreshRiskCheckBox(ACheck: TcxDBCheckBox);

    function GetAktifHafta: Integer;


  private
    { Private declarations }


  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}


procedure TForm2.SetHaftaAktif(AHafta: Integer);
var
  I: Integer;

  procedure SetCtrlEnabled(const BaseName: string; AEnabled: Boolean);
  var
    C: TComponent;
  begin
    C := FindComponent(BaseName);
    if Assigned(C) and (C is TControl) then
      TControl(C).Enabled := AEnabled;
  end;

begin
  // Güvenlik
  if (AHafta < 1) then Exit;
  if (AHafta > 5) then AHafta := 5;

  // 1–5 haftalar
  for I := 1 to 5 do
  begin
    // Aktif haftadan büyük olanlar KAPALI
    // Aktif ve öncekiler AÇIK
    // -------------------------------
    // Ölçümler
    SetCtrlEnabled('edtKiloGun' + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('edtBoyGun'  + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('edtBasGun'  + IntToStr(I), I <= AHafta);

    // YÜKSEK RİSK
    SetCtrlEnabled('YR_C28G'    + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('YR_C1000G'  + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('YR_CNEKG'   + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('YR_CGISG'   + IntToStr(I), I <= AHafta);

    // ORTA RİSK
    SetCtrlEnabled('OR_C28G'        + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('OR_CIUGRG'      + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('OR_C1000G'      + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('OR_CKONJENITALG'+ IntToStr(I), I <= AHafta);

    // DÜŞÜK RİSK
    SetCtrlEnabled('DR_C32G'   + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('DR_CIUGRG' + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('DR_C37G'   + IntToStr(I), I <= AHafta);

    // LABEL / SKOR
    SetCtrlEnabled('scorGun' + IntToStr(I), I <= AHafta);
    SetCtrlEnabled('DR_GUN'  + IntToStr(I), I <= AHafta);
  end;
end;


function TForm2.GetAktifHafta: Integer;
var
  Bmk: TBookmark;
begin
  Result := 0;

  if (not qrrastgeleHasta.Active) or qrrastgeleHasta.IsEmpty then
    Exit;

  Bmk := qrrastgeleHasta.GetBookmark;
  try
    qrrastgeleHasta.First;
    while not qrrastgeleHasta.Eof do
    begin
      // Aktif hafta = RISK_SEVIYE boş olan ilk kayıt
      if Trim(qrrastgeleHasta.FieldByName('RISK_SEVIYE').AsString) = '' then
      begin
        Result := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);
        Exit;
      end;
      qrrastgeleHasta.Next;
    end;

    // Hepsi doluysa son haftayı aktif kabul et
    qrrastgeleHasta.Last;
    Result := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);
  finally
    qrrastgeleHasta.GotoBookmark(Bmk);
    qrrastgeleHasta.FreeBookmark(Bmk);
  end;
end;


procedure TForm2.btnKaydetClick(Sender: TObject);
var
  AktifHafta, SonHafta, YeniHafta: Integer;
  KiloVar, BoyVar, BasVar: Boolean;
  DosyaNo, ProtokolNo: Integer;
begin
  if (not qrrastgeleHasta.Active) or qrrastgeleHasta.IsEmpty then
    Exit;

  // Mevcut hastanın anahtarları (tek kaynak qrrastgeleHasta)
  DosyaNo    := qrrastgeleHasta.FieldByName('DOSYA_NO').AsInteger;
  ProtokolNo := qrrastgeleHasta.FieldByName('PROTOKOL_NO').AsInteger;

  // Aktif hafta = ekranda bulunduğumuz satır
  AktifHafta := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);

  // En az bir ölçüm girilmiş mi?
  KiloVar := not qrrastgeleHasta.FieldByName('KILO_KG').IsNull;
  BoyVar  := not qrrastgeleHasta.FieldByName('BOY_CM').IsNull;
  BasVar  := not qrrastgeleHasta.FieldByName('BAS_CEVRESI_CM').IsNull;

  if not (KiloVar or BoyVar or BasVar) then
  begin
    ShowMessage('Lütfen en az bir ölçüm giriniz.');
    Exit;
  end;

  // Mevcut haftayı kaydet
  if not (qrrastgeleHasta.State in dsEditModes) then
    qrrastgeleHasta.Edit;

  qrrastgeleHasta.Post;

  // Son haftayı bul
  qrrastgeleHasta.Last;
  SonHafta := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);

  // Aktif hafta son haftaysa ve 5'ten küçükse yeni hafta aç
  if (AktifHafta = SonHafta) and (SonHafta < 5) then
  begin
    YeniHafta := SonHafta + 1;

    qrrastgeleHasta.Append;
    qrrastgeleHasta.FieldByName('HASTA_ID').AsInteger := 1; // test
    qrrastgeleHasta.FieldByName('HAFTA_NO').AsInteger := YeniHafta;
    qrrastgeleHasta.FieldByName('DOSYA_NO').AsInteger := DosyaNo;
    qrrastgeleHasta.FieldByName('PROTOKOL_NO').AsInteger := ProtokolNo;
    qrrastgeleHasta.FieldByName('IZLEM_TARIHI').AsDateTime := Date;
    qrrastgeleHasta.Post;

    // Yeni haftaya geçmiyoruz
    qrrastgeleHasta.Locate('HAFTA_NO', AktifHafta, []);
  end;

  ShowMessage('Kayıt kaydedildi.');
end;


procedure TForm2.FormShow(Sender: TObject);
const
  TEST_DOSYA_NO    = 12;
  TEST_PROTOKOL_NO = 400;
var
  DosyaNo, ProtokolNo: Integer;
  KayitSayisi: Integer;
  MinHafta, MaxHafta: Integer;
  AktifHafta: Integer;
  Msg: string;
  Bmk: TBookmark;

  function FieldExists(const AFieldName: string): Boolean;
  begin
    Result := Assigned(qrrastgeleHasta.FindField(AFieldName));
  end;

  function FieldIsRequired(const AFieldName: string): Boolean;
  var
    F: TField;
  begin
    Result := False;
    F := qrrastgeleHasta.FindField(AFieldName);
    if Assigned(F) then
      Result := F.Required;
  end;

  procedure CalcMinMaxHafta(out AMin, AMax: Integer);
  begin
    AMin := 0;
    AMax := 0;

    if (not qrrastgeleHasta.Active) or qrrastgeleHasta.IsEmpty then
      Exit;

    if not FieldExists('HAFTA_NO') then
      Exit;

    Bmk := qrrastgeleHasta.GetBookmark;
    try
      qrrastgeleHasta.First;
      AMin := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);

      qrrastgeleHasta.Last;
      AMax := Trunc(qrrastgeleHasta.FieldByName('HAFTA_NO').AsFloat);
    finally
      qrrastgeleHasta.GotoBookmark(Bmk);
      qrrastgeleHasta.FreeBookmark(Bmk);
    end;
  end;

begin
  // 1) Oracle bağlantısı
  if not Orsn1.Connected then
    Orsn1.Connected := True;

  // ==============================
  // ŞİMDİLİK TEST (12 / 400)
  // ==============================
  DosyaNo    := TEST_DOSYA_NO;
  ProtokolNo := TEST_PROTOKOL_NO;

  // ==============================
  // İLERİDE CANLI SİSTEM (örnek):
  // DosyaNo    := qrrastgeleHasta.FieldByName('DOSYA_NO').AsInteger;
  // ProtokolNo := qrrastgeleHasta.FieldByName('PROTOKOL_NO').AsInteger;
  //
  // veya formu açan yerden:
  // DosyaNo := DM.qrrastgeleHasta.FieldByName('DOSYA_NO').AsInteger;
  // ProtokolNo := DM.qrrastgeleHasta.FieldByName('PROTOKOL_NO').AsInteger;
  // ==============================

  // 2) Query kapat/aç
  if qrrastgeleHasta.Active then
    qrrastgeleHasta.Close;

  // 3) Parametreleri ver
  qrrastgeleHasta.ParamByName('DOSYA_NO').AsInteger    := DosyaNo;
  qrrastgeleHasta.ParamByName('PROTOKOL_NO').AsInteger := ProtokolNo;

  qrrastgeleHasta.Open;

  // 4) Kayıt bilgileri (açılış)
  KayitSayisi := qrrastgeleHasta.RecordCount;
  CalcMinMaxHafta(MinHafta, MaxHafta);

  // 5) DB boşsa -> 1. hafta oluşturmayı dene
  if qrrastgeleHasta.IsEmpty then
  begin
    qrrastgeleHasta.Append;

    // HAFTA_NO
    if FieldExists('HAFTA_NO') then
      qrrastgeleHasta.FieldByName('HAFTA_NO').AsInteger := 1;

    // DOSYA_NO / PROTOKOL_NO
    if FieldExists('DOSYA_NO') then
      qrrastgeleHasta.FieldByName('DOSYA_NO').AsInteger := DosyaNo;

    if FieldExists('PROTOKOL_NO') then
      qrrastgeleHasta.FieldByName('PROTOKOL_NO').AsInteger := ProtokolNo;

    // IZLEM_TARIHI
    if FieldExists('IZLEM_TARIHI') then
      qrrastgeleHasta.FieldByName('IZLEM_TARIHI').AsDateTime := Date;

    // HASTA_ID:
    // ÇOĞU DB'DE trigger/sequence üretir, bu yüzden elle set etmiyoruz.
    // Ama field Required ise ve DB üretmiyorsa Post patlar -> aşağıda yakalıyoruz.

    try
      qrrastgeleHasta.Post;
    except
      on E: Exception do
      begin
        qrrastgeleHasta.Cancel;

        Msg :=
          'İlk kayıt otomatik açılamadı!' + sLineBreak +
          'Sebep: ' + E.Message + sLineBreak + sLineBreak +
          'Kontrol:' + sLineBreak +
          '- HASTA_ID alanı Required mı? ' + BoolToStr(FieldIsRequired('HASTA_ID'), True) + sLineBreak +
          '- Eğer Required ise DB tarafında trigger/sequence ile otomatik üretilmeli.' + sLineBreak +
          '- Otomatik üretim yoksa HASTA_ID için NEXTVAL çekip set etmek gerekir.';

        ShowMessage(Msg);
        Exit;
      end;
    end;

    // tekrar aç
    qrrastgeleHasta.Close;
    qrrastgeleHasta.Open;
  end;

  // 6) Aktif haftayı bul ve o haftaya git
  AktifHafta := GetAktifHafta;
  if (AktifHafta > 0) and FieldExists('HAFTA_NO') then
    qrrastgeleHasta.Locate('HAFTA_NO', AktifHafta, [])
  else
    qrrastgeleHasta.First;

    // Haftaya göre alanları kilitle
    SetHaftaAktif(AktifHafta);


  // 7) Debug mesajı (güncel)
  KayitSayisi := qrrastgeleHasta.RecordCount;
  CalcMinMaxHafta(MinHafta, MaxHafta);

  Msg :=
    'DOSYA_NO: ' + IntToStr(DosyaNo) + sLineBreak +
    'PROTOKOL_NO: ' + IntToStr(ProtokolNo) + sLineBreak +
    'Geçmiş kayıt sayısı: ' + IntToStr(KayitSayisi) + sLineBreak +
    'Hafta aralığı: ' + IntToStr(MinHafta) + ' - ' + IntToStr(MaxHafta) + sLineBreak +
    'Aktif hafta: ' + IntToStr(AktifHafta);

  ShowMessage(Msg);



end;



procedure TForm2.lblGunTarihClick(Sender: TObject);
begin
  // TODO
end;


procedure TForm2.PaintBoxYuksekRiskPaint(Sender: TObject);
var
  R: TRect;
  LF: TLogFont;
  Txt: string;
  X, Y: Integer;
begin
  Txt := '2.RİSK BELİRLEME';

  with PaintBoxYuksekRisk.Canvas do
  begin
    Brush.Color := clBtnFace;
    FillRect(PaintBoxYuksekRisk.ClientRect);

    Font.Name := 'Segoe UI';
    Font.Size := 9;
    Font.Style := [fsBold];

    SetGraphicsMode(Handle, GM_ADVANCED);

    GetObject(Font.Handle, SizeOf(LF), @LF);
    LF.lfEscapement  := 900;
    LF.lfOrientation := 900;
    Font.Handle := CreateFontIndirect(LF);

    R := PaintBoxYuksekRisk.ClientRect;

    X := (R.Right - TextHeight(Txt)) div 2;
    Y := (R.Bottom + TextWidth(Txt)) div 2;

    TextOut(X, Y, Txt);
  end;
end;


procedure TForm2.RefreshRiskCheckBox(ACheck: TcxDBCheckBox);
begin
  if not Assigned(ACheck) then Exit;

  ACheck.ParentBackground := False;

  if ACheck.Checked then
  begin
    ACheck.Style.Color := clRed;
    ACheck.Style.Font.Style := [fsBold];
  end
  else
  begin
    ACheck.Style.Color := clWindow;
    ACheck.Style.Font.Style := [];
  end;
end;


procedure TForm2.RiskCheckBoxPropertiesChange(Sender: TObject);
var
  C: TcxDBCheckBox;
begin
  if not (Sender is TcxDBCheckBox) then Exit;
  C := TcxDBCheckBox(Sender);

  // DataSource üzerinden dataset Edit moduna alınır
  if Assigned(C.DataBinding.DataSource)
     and Assigned(C.DataBinding.DataSource.DataSet)
     and not (C.DataBinding.DataSource.DataSet.State in dsEditModes) then
    C.DataBinding.DataSource.DataSet.Edit;

  RefreshRiskCheckBox(C);
end;

end.
